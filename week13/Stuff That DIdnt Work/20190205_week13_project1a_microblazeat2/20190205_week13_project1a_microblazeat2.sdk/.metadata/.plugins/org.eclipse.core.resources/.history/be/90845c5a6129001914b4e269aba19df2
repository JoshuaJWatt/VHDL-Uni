/*Includes & Defines*/
#include <stdio.h>
#include <stdlib.h>
#include "xparameters.h"
#include "xil_types.h"
#include "xstatus.h"
#include "xil_testmem.h"
#include <math.h>
#include "xuartlite.h"
#include "xuartlite_l.h"

#define COMMAND_BUFFER_LENGTH 200
/*---------------------------------*/
int main()
{
    init_platform();
    /* Variables */
    int charcount;
    char cmdbuffer[COMMAND_BUFFER_LENGTH];
    char input;
    int gain;
    char* valstart;
    /*-------------*/

    while(1)
    {
    	xil_printf("\r\n$ ");
    	charcount = 0;
    	while(charcount < COMMAND_BUFFER_LENGTH)
    	{
    		input = XUartLite_RecvByte(XPAR_UARTLITE_0_BASEADDR); /*Code to receive character*/

    		if(input == (char)'\r') /*For Return*/
    		{
    			cmdbuffer[charcount]='\0'; /*ends memory usage with terminate character*/
    			/*Interpret inputs into commands*/
    			if(strstr(cmdbuffer, "gain")!=0)
    			{
    				valstart=strstr(cmdbuffer, "=") +1;
    				gain = atoi(valstart);
    			}
    			/*New line and prompt*/
    			xil_printf("\r\n$ ");
    		}
    		else /*For all other characters*/
    		{

    		}
    	}
    	xil_printf("Command buffer full. REsetting it \r\n");
    }

    cleanup_platform();
    return 0;
}
